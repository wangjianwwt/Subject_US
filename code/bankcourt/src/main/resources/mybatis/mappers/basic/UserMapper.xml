<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.born.bc.basic.dao.UserMapper">
    <resultMap id="BaseResultMap_User" type="com.born.bc.basic.entity.User">
        <id column="ID" property="id" jdbcType="VARCHAR"/>
        <result column="LOGIN_NAME" property="loginName" jdbcType="VARCHAR"/>
        <result column="PASSWORD" property="password" jdbcType="VARCHAR"/>
        <result column="REAL_NAME" property="realName" jdbcType="VARCHAR"/>
        <result column="PHONE" property="phone" jdbcType="VARCHAR"/>
        <result column="EMAIL" property="email" jdbcType="VARCHAR"/>
        <result column="ENABLE_STATUS" property="enableStatus" jdbcType="INTEGER"/>
    </resultMap>

    <sql id="Base_Column_List_User">
        ID, LOGIN_NAME, PASSWORD, REAL_NAME, PHONE, EMAIL, ENABLE_STATUS, FORMMAKER_ID, FORMMAKER_NAME,
        CREATE_TIME
    </sql>

    <select id="getUserByLoginName" parameterType="java.lang.String" resultMap="BaseResultMap_User">
        select
        <include refid="Base_Column_List_User"/>
        from T_USER where LOGIN_NAME = #{loginName,jdbcType=VARCHAR} or PHONE = #{loginName,jdbcType=VARCHAR}
    </select>

    <select id="validateUserByLoginName" resultMap="BaseResultMap_User">
        select
        <include refid="Base_Column_List_User"/>
        from T_USER
        <where>
            DEL_STATUS = 0
            <if test="id != null and id != ''">
                and ID &lt;&gt; #{id, jdbcType=VARCHAR}
            </if>
            and ( LOGIN_NAME = #{loginName,jdbcType=VARCHAR}
            or PHONE = #{phone,jdbcType=VARCHAR} )
        </where>
    </select>

    <update id="updateUserDelStatus" parameterType="java.lang.String">
        update T_USER set DEL_STATUS = 1 , LAST_MODIFIED_TIME = current_timestamp where ID = #{id,jdbcType=VARCHAR}
    </update>

    <select id="findUserList" parameterType="com.born.bc.basic.entity.User" resultMap="BaseResultMap_User">
        SELECT
        <include refid="Base_Column_List_User"/>
        FROM T_USER
        <where>
            DEL_STATUS = 0
            <if test="entity.loginName != null and entity.loginName != ''">
                and LOGIN_NAME = #{entity.loginName,jdbcType=VARCHAR}
            </if>
            <if test="entity.enableStatus != null and entity.enableStatus != ''">
                and ENABLE_STATUS = #{entity.enableStatus,jdbcType=INTEGER}
            </if>
        </where>
    </select>

    <insert id="insertSelective" parameterType="com.born.bc.basic.entity.User">
        insert into t_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                ID,
            </if>
            <if test="loginName != null">
                LOGIN_NAME,
            </if>
            <if test="password != null">
                PASSWORD,
            </if>
            <if test="realName != null">
                REAL_NAME,
            </if>
            <if test="phone != null">
                PHONE,
            </if>
            <if test="email != null">
                EMAIL,
            </if>
            <if test="enableStatus != null">
                ENABLE_STATUS,
            </if>
            <if test="formmakerId != null">
                FORMMAKER_ID,
            </if>
            <if test="formmakerName != null">
                FORMMAKER_NAME,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=VARCHAR},
            </if>
            <if test="loginName != null">
                #{loginName,jdbcType=VARCHAR},
            </if>
            <if test="password != null">
                #{password,jdbcType=VARCHAR},
            </if>
            <if test="realName != null">
                #{realName,jdbcType=VARCHAR},
            </if>
            <if test="phone != null">
                #{phone,jdbcType=VARCHAR},
            </if>
            <if test="email != null">
                #{email,jdbcType=VARCHAR},
            </if>
            <if test="enableStatus != null">
                #{enableStatus,jdbcType=INTEGER},
            </if>
            <if test="formmakerId != null">
                #{formmakerId,jdbcType=VARCHAR},
            </if>
            <if test="formmakerName != null">
                #{formmakerName,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>

    <update id="updateByPrimaryKeySelective" parameterType="com.born.bc.basic.entity.User">
        update t_user
        <set>
            <if test="loginName != null and loginName != ''">
                LOGIN_NAME = #{loginName,jdbcType=VARCHAR},
            </if>
            <if test="password != null and password != ''">
                PASSWORD = #{password,jdbcType=VARCHAR},
            </if>
            <if test="realName != null and realName != ''">
                REAL_NAME = #{realName,jdbcType=VARCHAR},
            </if>
            <if test="phone != null and phone != ''">
                PHONE = #{phone,jdbcType=VARCHAR},
            </if>
            <if test="email != null and email != ''">
                EMAIL = #{email,jdbcType=VARCHAR},
            </if>
            <if test="enableStatus != null and enableStatus != ''">
                ENABLE_STATUS = #{enableStatus,jdbcType=INTEGER},
            </if>
            <if test="formmakerId != null and formmakerId != ''">
                FORMMAKER_ID = #{formmakerId,jdbcType=VARCHAR},
            </if>
            <if test="formmakerName != null and formmakerName != ''">
                FORMMAKER_NAME = #{formmakerName,jdbcType=VARCHAR},
            </if>
            LAST_MODIFIED_TIME = current_timestamp
        </set>
        where ID = #{id,jdbcType=VARCHAR}
    </update>

    <insert id="batchInsertUserRoleRelation" parameterType="java.util.List">
        BEGIN
        <foreach collection="list" item="item" index="index" separator=";">
            INSERT INTO T_USER_ROLE (
            ID, USER_ID, ROLE_ID, FORMMAKER_ID, FORMMAKER_NAME
            ) VALUES (
            #{item.id, jdbcType=VARCHAR},
            #{item.userId, jdbcType=VARCHAR},
            #{item.roleId, jdbcType=VARCHAR},
            #{item.formmakerId, jdbcType=VARCHAR},
            #{item.formmakerName, jdbcType=VARCHAR}
            )
        </foreach>
        ;END ;
    </insert>


    <update id="updateUserAndRoleDelStatus" parameterType="java.lang.String">
        update T_USER_ROLE SET DEL_STATUS = 1, LAST_MODIFIED_TIME = current_timestamp where DEL_STATUS = 0 and USER_ID = #{userId, jdbcType=VARCHAR}
    </update>

    <select id="selectById" parameterType="java.lang.String" resultMap="BaseResultMap_User">
        select
        <include refid="Base_Column_List_User" />
        FROM t_user
        where DEL_STATUS = 0 and ID = #{id, jdbcType=VARCHAR}
    </select>


</mapper>